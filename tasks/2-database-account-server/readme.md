## Рубежный контроль \#2

### Database authentication HTTP-server

На РК \#1 мы сделали In-memory authentication HTTP-server
Теперь наша задача состоит в миграции сервера из памяти в базу данных.

### Задание
Основываясь на коде РК \#1, разработать **Database authentication HTTP-server** (AuthServer).
AuthServer должен удовлетворять API, описанному далее.


### Форма и сроки сдачи
- Срок сдачи: **8 ноября** на лекции. Целое занятие будет посвящено сдаче этого задания.
- Задание выполняется в командах
- Формат сдачи:
    1. Вы поднимаете свой AuthServer
    2. С помошью тестовых сценариев вы доказываете, что сервис работает
    3. Оцениваем полноту тестовых сценариев
    4. Задаем вопросы об организации работы в комманде
    5. Смотрим код AuthServer'а и обсуждаем его
- Максимальное количество баллов, которое можно получить за первый рубежный контроль - **12**
- Обращаю внимание, что вы должны понимать (уметь объяснить) для чего нужна каждая строчка вашего кода.

### Актуальность
Вы и сами всё понимаете.

### Database
Мы будем сохранять данные пользователей в базу данных. Базы доступны по адресу 54.224.37.210 [Пост с раздачей](https://atom.mail.ru/blog/topic/67/)
Все данные пользователя должны храниться в базе данных. Данные не должны теряться при перезапуске AuthServer'а.

### Обязательные сущности
- Token - объект, содержащий уникальную информацию - случайный Long и дату выдачи:
    ``` java
    class Token {
        Long id;
        Data date;
        ...
    }
    ```
    
- User - класс пользователя:
    ``` java
    class User {
        id;
        name;
        password
        registration date; // ! не предоставлять api для изменения даты регистрации !
        email;
        ...
    }
    ```
- Хранилище токенов - выданные токены должны храниться в базе данных.

### API
API практически не поменялся относительно РК \#1

1. Регистрация пользователя

    При регистрации обязательно выставить дату регистрации пользователя.
    Повторная регистрация пользователя c именем {user} должна быть запрещена. Выберите соответствующий HTTP код ошибки
    ```
    Protocol: HTTP
    Path: auth/register
    Method: POST
    Host: {IP}:8080 (IP = localhost при локальном тестрировании сервера)
    Headers:
      Content-Type: application/x-www-form-urlencoded
    Body:
      user={}&password={}
    Response:
      Code: 200
      Content-Type: text/plain
      Body: сообщение об успехе
    ```

2. Авторизация(логин) пользователя

    Авторизация позволяет по паре (user, password) получить токен, если пользователь зарегистрирован.
    Чтобы иметь доступ к другим запросам, требующих авторизации (предоставления токена при запросе).

    Выданный токен прекращает действовать только если:
        - пользователь разлогинился

    Если токен пользователя не прекращал действовать, то повторный логин должен приводить к выдаче такого же токена, что и в первый раз.
    ```
    Protocol: HTTP
    Path: auth/login
    Method: POST
    Host: {IP}:8080 (IP = localhost при локальном тестрировании сервера)
    Headers:
        Content-Type: application/x-www-form-urlencoded
    Body:
        user={}&password={}
    Response:
        Code: 200
        Сontent-Type: text/plain
        Body: token
    ```

3. Логаут пользователя

    **! Для этого запроса необходим токен !**

    Удаляет токен пользователя из базы.
    ```
    Protocol: HTTP
    Path: auth/logout
    Method: POST
    Host: {IP}:8080 (IP = localhost при локальном тестрировании сервера)
    Headers:
        Authorization: Bearer {token}
    Response:
        Code: 200
        Сontent-Type: text/plain
        Body: сообщение об успехе
    ```

4. Обновление имени пользователя

    **! Для этого запроса необходим токен !**

    Выставляет пользователю (владельцу токена) переданное в запросе имя.
    ```
    Protocol: HTTP
    Path: profile/name
    Method: POST
    Host: {IP}:8080 (IP = localhost при локальном тестрировании сервера)
    Headers:
        Authorization: Bearer {token}
        Content-Type: application/x-www-form-urlencoded
    Body:
        name={}
    Response:
        Code: 200
        Сontent-Type: text/plain
        Body: сообщение об успехе
    ```

5. Обновление других данных пользователя (e-mail, password)

    **! Для этих запросов необходим токен !**

    Определите структуру запросов самостоятельно

6. Получение информации о залогиненных пользователях

    Позволяет получть json с информацией о залогиненных пользователях.
    В информации о пользователях обязательно должно присутствовать имя и дата регистрации.
    ```
    Protocol: HTTP
    Path: data/users
    Method: GET
    Host: {IP}:8080 (IP = localhost при локальном тестрировании сервера)
    Response:
        Code: 200
        Сontent-Type: application/json
        Body: json вида {"users" : [{User1}, {User2}, ... ]}
    ```

7. Leaderboard

    Таблица результатов.
    Каждый игрок после окончания матча получает какое-то количество очков. Эти очки суммируются.
    Ваша задача - придумать и реализовать сервис хранения очков зарегистрированных пользователей.
    Таблица состоит из записей (user, score) и должна храниться в базе данных

    Должен быть реализован интерфейс для получения лучших `N` игроков
    ```
    Protocol: HTTP
    Path: data/leaderboard
    Method: GET
    Host: {IP}:8080 (IP = localhost при локальном тестрировании сервера)
    ```

### Реализация
Ваша реализация должна быть основана на результатах РК \#1
Примеры общения с базой есть в предыдущих лекциях.

Работа с таблицей Leaderboard должна осуществляться через JDBC.
Работа со всеми остальными таблицами должны осуществляться через ORM.

### Тестовые сценарии
Тестовые сценарии должны максимально покрывать ваш функционал.

### Работа в команде
Это командное задание, будет в первую очередь оценен прогресс комманды.
Работа осуществляется в открытом репозитории.
Каждый член команды должен полностью понимать как работает проект.
Разделение работы в комманде - ваша задача.

